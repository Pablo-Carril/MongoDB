<form id="formEntrada" action="/api/validadores" method="post">
  <!-- manejamos todo desde el Server. ahora usamos el action y Solicitudes HHTP (POST,get,put,delete).-->
  <div class="form-group">
    <label for="equipoSelect">Equipo:</label>
    <select class="custom-select form-control" name='equipo' id="equipoSelect" required="">
      <option selected value="Validador">Validador</option>
      <option value="Teclado">Teclado</option>
      <option value="MountinKit">Mountin Kit</option>
      <option value="Concentrador">Concentrador</option>
      <option value="Otros">Otros</option>
    </select>
    <label for="serie">Numero de serie:</label>
    <input type="number" value="{{serie}}" name="serie" id="serie" class="form-control" min="1" max="999999999"
      title="Numero de serie" required="" autofocus>
    <label for="fecha">Fecha:</label> <!--Los label for = deben apuntar al id no al name -->
    <input type="date" value='{{fechaActual}}' name="fecha" id="fecha" class="form-control">

    <label for="linea">Linea:</label>
    <select name="linea" class="custom-select form-control" id="linea" required="">
      <option value="85" {{isSelected linea '85' }}>85</option>
      <option value="98" {{isSelected linea '98' }}>98</option>
      <option value="307" {{isSelected linea '307' }}>307</option>
      <option value="275" {{isSelected linea '275' }}>275</option>
    </select>
    <label for="coche">Coche:</label>
    <input type="number" value="{{coche}}" name="coche" id="coche" class="form-control">
    <label for="problema">Problema:</label>
    <div class="form-group">
      <textarea type="number" name="problema" id="problema" cols="30" rows="1" minlength="3" maxlength="150" required=""
        class="form-control">{{problema}}</textarea>
    </div>
    <label for="caso">Caso:</label>
    <div class="form-group">
      <textarea name="caso" id="caso" cols="20" rows="1" minlength="6" maxlength="8"
        class="form-control mb-3">{{caso}}</textarea>
    </div>
    <button id="guardar" class="btn btn-primary text-white {{#if ocultar}}oculto{{/if}} ">Guardar</button>
    <button id="consultar" class="btn btn-primary text-white {{#if ocultar}}oculto{{/if}} ">Consultar</button>
  </div>
</form>

<style>
  .oculto {
    display: none;
  }

  #problema {
    white-space: nowrap;
    /* evita el salto de línea */
    text-overflow: ellipsis;
    /* agrega puntos suspensivos... no funciona sin el nowrap */
    overflow-x: hidden;
    /* oculta el texto que se desborda. con "auto" me agrega la barra de scroll */
  }
</style>

<script>
  let numSerie = ""
  const serieInput = document.getElementById("serie")
  serieInput.addEventListener('input', () => {       //cada vez que se presione una tecla captura lo escrito.
    numSerie = serieInput.value
    //console.log(numSerie)
  })
  serieInput.addEventListener('keypress', e => {       //al apretar enter CONSULTAMOS mediante redirección url a ese serie.
    if (e.key == "Enter") {         // nesesito agregarlos a todos los input ??   SI ...A LA MAYORIA
      var url = '/api/validadores/' + numSerie    //+ encodeURIComponent({{serie}});
      window.location.href = url
      //e.preventDefault()
    }
  })

  //Al consultar leemos el numero de serie ingresado por el usuario    FUNCIONA!!! aunque esté en otro handlebars!!
  const consultarBtn = document.getElementById('consultar')
  consultarBtn.addEventListener('click', () => {
    const serieInput = document.getElementById('serie')     //leemos el serie ingresado. no se puede desde el servidor. 
    const serieNum = serieInput.value                     // SALVO que hagamos un formulario normal y nos evitamos todo este Javascript. HACERLO EN EL FUTURO
    if (serieNum) {
      var url = '/api/validadores/' + encodeURIComponent(serieNum);
    } else { url = '#' }
    //fetch(url)    //un fetch sería buena opción para enviar los datos por el body y no por la url
    window.location.href = url    //como el enlace tiene un # necesitamos darle la nueva url                    
  })

  const serieHistorial = document.getElementById("serieHistorial")
  const equipoInput = document.getElementById("equipoSelect")
  equipoInput.addEventListener('input', () => {

    equipoElegido = equipoInput.value
    console.log(equipoElegido)
    console.log('{{colorOpcion equipoElegido}}')

  /*  if (equipoInput.value == 'Validador') {
      equipoInput.style.border = "3px solid #0d6efd" //#86b7fe
      serieHistorial.style.color = "#0d6efd"   //no se puede desde formulario. probar con variable global
    }
    if (equipoElegido == 'Teclado') {
      equipoInput.style.border = "3px solid" + {{colorOpcion equipoElegido}} 
    }
    /*
    if (equipoInput.value == 'MountinKit') {
      equipoInput.style.border = "3px solid #ffc107"  
    }
    if (equipoInput.value == 'Concentrador') {
      equipoInput.style.border = "3px solid #fd7e14"  
    }
     if (equipoInput.value == 'Otros') {
      equipoInput.style.border = "3px solid #666"  
    }
  */

  })



</script>